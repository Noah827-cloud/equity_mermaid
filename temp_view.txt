                    with st.expander("查看详细错误信息"):
                        for error in errors:
                            st.code(error)

                if st.button("确认并刷新列表", type="primary", key="subsidiary_import_refresh_final"):
                    st.rerun()
                else:
                    st.info("点击上方按钮刷新列表，查看导入结果")
                                # 尝试从字符串中提取数字
                                num_str = re.search(r'\d+(\.\d+)?', str(percentage_value))
                                if num_str:
                                    percentage = float(num_str.group())
                                    if not (0 <= percentage <= 100):
                                        skipped_count += 1
                                        errors.append(f"第{index+1}行: 提取的比例 {percentage} 超出有效范围")
                                        continue
                                else:
                                    skipped_count += 1
                                    errors.append(f"第{index+1}行: 无法从 '{percentage_value}' 中提取比例")
                                    continue
                            except Exception as e:
                                # 如果无法转换为数字，跳过
                                skipped_count += 1
                                errors.append(f"第{index+1}行: 比例转换失败 - {str(e)}")
                                continue
                            
