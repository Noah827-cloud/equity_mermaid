                                        "child": subsidiary_name,
                                        "percentage": percentage
                                    })
                                
                                imported_count += 1
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
股权结构手动编辑工具

本模块提供手动添加公司、股东、子公司及关系的界面，生成与图片识别相同格式的JSON数据，
并使用相同的mermaid_function来生成图表。
"""

import os
import sys
import json
import streamlit as st
from datetime import datetime
from streamlit_mermaid import st_mermaid
import pathlib

# 添加项目根目录到Python路径
sys.path.append(os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__)))))

# 设置页面配置
st.set_page_config(
    page_title="股权结构图生成工具 - 手动编辑模式",
    page_icon="📊",
    layout="wide",
    initial_sidebar_state="collapsed"  # 默认折叠侧边栏
)

# 添加CSS样式来隐藏默认的导航内容，但保留自定义侧边栏
st.markdown("""
<style>
    /* 设置主题变量 */
    :root {
        --primary-color: #0f4c81;
    }
    
    /* 隐藏默认的导航内容 */
    [data-testid="stSidebarNav"],[data-testid="stSidebar"] [href*="main_page"],[data-testid="stSidebar"] [href*="1_图像识别模式"],[data-testid="stSidebar"] [href*="2_手动编辑模式"] {display:none !important;visibility:hidden !important;height:0 !important;width:0 !important;opacity:0 !important;}
    
    /* 隐藏 sidebar header 上的 keyboard 提示 */ 
    [data-testid="stSidebar"] .streamlit-expanderHeader button div {display:none !important;}
    
    /* 侧边栏整体背景色与宽度 */ 
    [data-testid="stSidebar"] {
        background-color: var(--primary-color) !important; /* 使用主色调 */ 
        color: #ffffff !important;            /* 白色字体 */ 
        padding: 1rem 0.5rem;
        min-width: 250px !important;          /* 最小宽度 */ 
        max-width: 280px !important;          /* 最大宽度 */ 
    }
    
    /* 确保侧边栏内容区域也使用主色调背景 */
    [data-testid="stSidebar"] section,[data-testid="stSidebar"] .sidebar-content {
        background-color: var(--primary-color) !important;
        background: var(--primary-color) !important;
    }
    
    /* Sidebar 标题美化 */ 
    [data-testid="stSidebar"] h2,[data-testid="stSidebar"] h3 {color:#4fc3f7 !important;font-weight:700 !important;}
    
    /* 设置侧边栏按钮背景为透明 */
    [data-testid="stSidebar"] button,[data-testid="stSidebar"] button[data-testid="stBaseButton-secondary"],[data-testid="stSidebar"] [data-testid="stButton"] > button {
        background: transparent !important;
        background-color: transparent !important;
        color: white !important;
        border: none !important;
        box-shadow: none !important;
        opacity: 1 !important;
        background-image: none !important;
        border-radius: 0 !important;
        padding: 0.5rem 1rem !important;
    }
    
    /* 确保按钮内的所有内容都透明 */
    [data-testid="stSidebar"] button *,[data-testid="stSidebar"] [data-testid="stBaseButton-secondary"] * {
        background-color: transparent !important;
        background: transparent !important;
        box-shadow: none !important;
    }
    
    /* Sidebar 内文字统一 - 高优先级 */ 
    [data-testid="stSidebar"] p,
    [data-testid="stSidebar"] label,
    [data-testid="stSidebar"] span {
        color: #e0e0e0 !important;
        font-size: 14px !important;  /* 添加!important确保优先级 */
    }
    
    /* 侧边栏展开面板内容的更具体样式控制 - 最高优先级 */
    [data-testid="stSidebar"] [data-testid="stExpander"] .streamlit-expanderContent {
        font-size: 14px !important !important;
        color: #e0e0e0 !important !important;
        text-align: left !important !important;
    }
    
    /* 确保展开面板内的所有文本元素都使用相同的字体大小 - 最高优先级 */
    [data-testid="stSidebar"] [data-testid="stExpander"] .streamlit-expanderContent * {
        font-size: 14px !important !important;
        color: #e0e0e0 !important !important;
        text-align: left !important !important;
        line-height: 1.4 !important !important;
        font-weight: normal !important !important;
    }
    
    /* 针对展开面板内使用st.write()生成的内容的特定样式 */
    [data-testid="stSidebar"] [data-testid="stExpander"] .streamlit-expanderContent p,
    [data-testid="stSidebar"] [data-testid="stExpander"] .streamlit-expanderContent h1,
    [data-testid="stSidebar"] [data-testid="stExpander"] .streamlit-expanderContent h2,
    [data-testid="stSidebar"] [data-testid="stExpander"] .streamlit-expanderContent h3,
    [data-testid="stSidebar"] [data-testid="stExpander"] .streamlit-expanderContent h4,
    [data-testid="stSidebar"] [data-testid="stExpander"] .streamlit-expanderContent h5,
    [data-testid="stSidebar"] [data-testid="stExpander"] .streamlit-expanderContent h6,
    [data-testid="stSidebar"] [data-testid="stExpander"] .streamlit-expanderContent li,
    [data-testid="stSidebar"] [data-testid="stExpander"] .streamlit-expanderContent span {
        font-size: 14px !important !important;
        color: #e0e0e0 !important !important;
